<?php$this->load->view('site/includes/header');$currency_result = $this->session->userdata('currency_result');$product = $ProductDetail->row();$user_currencycode = $product->currency;$commission = $hosting_payment_details->row()->commission_percentage;$promotion_type = $hosting_payment_details->row()->promotion_type;if ($promotion_type == 'percentage') {    $hosting_price = ($product->price / 100) * $commission;    if ($user_currencycode != "USD") {		$hosting_price = currency_conversion($user_currencycode, $this->session->userdata('currency_type'), $hosting_price);        /*if ($currency_result->$user_currencycode) {            $hosting_price = $hosting_price / $currency_result->$user_currencycode;        } else {            $hosting_price = currency_conversion($user_currencycode, $this->session->userdata('currency_type'), $hosting_price);        }*/    }} else {    $hosting_price = $commission;	}$hosting_total_price = $product->price;define("paypal", $this->config->item('payment_0'));$paypal = unserialize(paypal);$paypalVal = $paypal['status'];define("StripeDetails", $this->config->item('payment_1'));$StripeValDet = unserialize(StripeDetails);$StripeVal = $StripeValDet['status'];$StripeValDet1 = unserialize($StripeValDet['settings']);?>    <script type="text/javascript" src="https://js.stripe.com/v2/"></script>    <script type="text/javascript">        Stripe.setPublishableKey('<?php echo $StripeValDet1['publishable_key']; ?>');    </script>    <section>        <div class="container">            <div class="row">                <div class="col-md-5 swapRight">                    <div class="paymentRight">                        <div class="tableRow head">                            <div class="left">                                <h5><?php echo ucfirst($product->product_title); ?>                                    <small><?php                                        //echo ' - ';                                        //echo $currencySymbol;                                        if ($user_currencycode != $this->session->userdata('currency_type')) {                                            /*if ($currency_result->$user_currencycode) {                                                $global_price = $product->price / $currency_result->$user_currencycode;                                            } else {                                                $global_price = currency_conversion($user_currencycode, $this->session->userdata('currency_type'), $product->price);                                            }*/											$global_price = currency_conversion($user_currencycode, $this->session->userdata('currency_type'), $product->price);                                        } else {                                            $global_price = currency_conversion($product->currency, $this->session->userdata('currency_type'), $product->price);                                        }                                       // echo number_format($global_price, 2) . ' ' . $this->session->userdata('currency_type');                                        ?></small>                                </h5>                                <div class="sub"><?php $address = explode(',', $product->address);                                    $i = 1;                                    foreach ($address as $addr) {                                        echo $addr;                                        echo ($i == count($address)) ? '.' : ',';                                        echo '<br>';                                        $i++;                                    } ?></div>                            </div>                            <div class="right">                                <?php                                $img_src = 'dummyProductImage.jpg';                                if ($product->product_image != "" && file_exists('./images/rental/' . $product->product_image)) {                                    $img_src = $product->product_image;                                }                                echo img(base_url() . 'images/rental/' . $img_src, '', array("class" => "propImg"));                                ?>								<h5><?php echo $currencySymbol.number_format($global_price, 2) . ' ' . $this->session->userdata('currency_type'); ?></h5>                            </div>                        </div>                        <div class="divider"></div>                        <div class="tableRow">                            <div class="left">							<?php 								if($this->session->userdata('currency_type')!="USD"){									//$hostPrice= convertCurrency("USD",$this->session->userdata('currency_type'),$hosting_price);									$hostPrice = currency_conversion('USD', $this->session->userdata('currency_type'), $hosting_price);								}else{									 $hostPrice= $hosting_price;								}	 							?>							                                <p> <?php                                    if ($this->lang->line('This payment transacts in') != '') {                                        echo stripslashes($this->lang->line('This payment transacts in'));                                    } else echo "This payment transacts in";                                    echo " ".$currencySymbol . $hostPrice;                                    ?></p>                            </div>                            <div class="right">                                <h5></h5>                            </div>                        </div>                    </div>                </div>                <div class="col-md-7">                    <div class="paymentOption">                        <div class="panel-group" id="accordion">                              <?php if (($paypalVal == 'Disable') && ($StripeVal == 'Disable')) { ?> <p class="text-center text-danger"><?php if ($this->lang->line('no_payment_method') != '') {                            echo stripslashes($this->lang->line('no_payment_method'));                        } else echo "No Payment Method is Available"; ?></p>                            <?php  ?><?php } elseif ($StripeVal != 'Disable') {  ?>                            <div class="panel panel-default">                                <div class="panel-heading">                                    <h4 class="panel-title">                                        <a data-toggle="collapse" data-parent="#accordion" href="#collapse2">                                            <h5><?php  									if ($this->lang->line('Stripe') != '') {                                        echo stripslashes($this->lang->line('Stripe'));                                    } else echo "Stripe";											?></h5></a>																						                                    </h4>                                </div>                                <div id="collapse2" class="panel-collapse collapse in">                                    <div class="panel-body">                                        <div class="icons">                                            <img src="<?php echo base_url(); ?>images/visa.png">                                            <img src="<?php echo base_url(); ?>images/masterCard.png">                                            <img src="<?php echo base_url(); ?>images/americanExpress.png">                                            <img src="<?php echo base_url(); ?>images/discover.png">                                        </div>                                        <?php                                        echo form_open('site/product/HostPaymentCredit', array('id' => 'credit_card_forms_stripe'));                                        echo form_input(array('type' => 'hidden', 'name' => 'stripe_mode', 'id' => 'stripe_mode', 'value' => $StripeValDet1['mode']));                                        echo form_input(array('type' => 'hidden', 'name' => 'stripe_key', 'id' => 'stripe_key', 'value' => $StripeValDet1['secret_key']));                                        echo form_input(array('type' => 'hidden', 'name' => 'stripe_publish_key', 'id' => 'stripe_publish_key', 'value' => $StripeValDet1['publishable_key']));                                        echo form_input(array('type' => 'hidden', 'name' => 'payment_method', 'id' => 'payment_method', 'value' => 'StripeCreditCard'));                                        echo form_input(array('type' => 'hidden', 'name' => 'commission', 'id' => 'commission', 'value' => $commission));                                        echo form_input(array('type' => 'hidden', 'name' => 'commission_type', 'id' => 'commission_type', 'value' => $promotion_type));                                        echo form_input(array('type' => 'hidden', 'name' => 'hosting_priceAdminCur', 'id' => 'hosting_priceAdminCur', 'value' => $hosting_price));                                        echo form_input(array('type' => 'hidden', 'name' => 'hosting_price', 'id' => 'hosting_price', 'value' => $hosting_price));                                        echo form_input(array('type' => 'hidden', 'name' => 'booking_rental_id', 'id' => 'booking_rental_id', 'value' => $product->id));                                        echo form_input(array('type' => 'hidden', 'name' => 'creditvalue', 'id' => 'creditvalue', 'value' => 'stripe'));                                        echo form_input(array('type' => 'hidden', 'name' => 'productPrice', 'id' => 'productPrice', 'value' => $product->price));                                        ?>                                        <p class="text-center text-success" id="loadingContainer"                                           style="display: none;"><i                                                    class="fa fa-spinner fa-spin fa-1x fa-fw"></i> <?php if ($this->lang->line('Please wait your transaction on process') != '') {                                                echo stripslashes($this->lang->line('Please wait your transaction on process'));                                            } else echo "Please wait your transaction on process"; ?></p>                                        <p class="text-center text-danger" id="StripePaymentErrors"                                           style="display: none;"></p>                                        <label><?php if ($this->lang->line('Card Type') != '') {                                                echo stripslashes($this->lang->line('Card Type'));                                            } else echo "Card Type"; ?></label>                                        <?php                                        if ($this->lang->line('select_card_type') != '') {                                            $selectLabel = stripslashes($this->lang->line('select_card_type'));                                        } else $selectLabel = 'Select Card Type';                                         if ($this->lang->line('Visa') != '') {                                            $visaLabel = stripslashes($this->lang->line('Visa'));                                        } else $visaLabel = 'Visa';                                        if ($this->lang->line('American Express') != '') {                                            $AmexLabel = stripslashes($this->lang->line('American Express'));                                        } else $AmexLabel = 'American Express';                                        if ($this->lang->line('MasterCard') != '') {                                            $MasterCardLabel = stripslashes($this->lang->line('MasterCard'));                                        } else $MasterCardLabel = 'MasterCard';                                        if ($this->lang->line('Discover') != '') {                                            $DiscoverLabel = stripslashes($this->lang->line('Discover'));                                        } else $DiscoverLabel = 'Discover';                                        $CardOptions = array(''=>$selectLabel,'Visa' => $visaLabel, 'Amex' => $AmexLabel, 'MasterCard' => $MasterCardLabel, 'Discover' => $DiscoverLabel);                                        echo form_dropdown('cardType', $CardOptions, '', array('id' => 'cardType'));                                        ?>                                        <label><?php if ($this->lang->line('Credit Card Number') != '') {                                                echo stripslashes($this->lang->line('Credit Card Number'));                                            } else echo "Credit Card Number"; ?></label>																																																							<?php if ($this->lang->line('enter_credit_card_num') != '') {                                                $ent_crd= stripslashes($this->lang->line('enter_credit_card_num'));                                            } else $ent_crd= "Enter Credit Card Number"; ?>											                                        <?php                                        echo form_input('cardNumber', '', array('placeholder' => "$ent_crd", 'autocomplete' => 'off', 'id' => 'cardNumber', 'maxlength' => '16', 'data-stripe' => 'number'));                                        ?>                                        <div class="row">                                            <div class="col-sm-6">                                                <div class="row">                                                    <label class="col-sm-12"><?php if ($this->lang->line('Expiration Date') != '') {                                                            echo stripslashes($this->lang->line('Expiration Date'));                                                        } else echo "Expiration Date"; ?></label>                                                    <div class="col-sm-5">                                                        <?php                                                        $expriedMonth = array();                                                        $expriedMonth[''] = 'MM';                                                        for ($i = 1; $i <= 12; $i++) {                                                            $expriedMonth[$i] = $i;                                                        }                                                        echo form_dropdown('CCExpMonth', $expriedMonth, '', array('id' => 'CCExpMonth', 'data-stripe' => 'exp-month'));                                                        ?>                                                    </div>                                                    <div class="col-sm-7">                                                        <?php                                                        $expriedYear = array();                                                        $expriedYear[''] = 'YYYY';                                                        for ($i = date('Y'); $i < (date('Y') + 30); $i++) {                                                            $expriedYear[$i] = $i;                                                        }                                                        echo form_dropdown('CCExpYear', $expriedYear, '', array('id' => 'CCExpYear', 'data-stripe' => 'exp-year'));                                                        ?>                                                    </div>                                                </div>                                            </div>                                            <div class="col-sm-6">                                                <label><?php if ($this->lang->line('Security Code') != '') {                                                        echo stripslashes($this->lang->line('Security Code'));                                                    } else echo "Security Code"; ?>                                                </label>																								<?php if ($this->lang->line('enter_security_code') != '') {                                                        $ent_sec= stripslashes($this->lang->line('enter_security_code'));                                                    } else $ent_sec= "Enter Security Code"; ?>													                                                <?php                                                echo form_password('creditCardIdentifier', '', array('placeholder' => "$ent_sec", 'autocomplete' => 'off', 'id' => 'creditCardIdentifier', 'data-stripe' => 'cvc'));                                                ?>                                            </div>                                        </div>                                        <button class="submitBtn" onclick="return stripePayment();"                                                id="StripePaymentButton"><?php if ($this->lang->line('Book it using Credit Card') != '') {                                                echo stripslashes($this->lang->line('Book it using Credit Card'));                                            } else echo "Book it using Credit Card"; ?></button>                                        <?php echo form_close(); ?>                                    </div>                                </div>                            </div>                        <?php  ?>                        <?php } ?>                        <?php if ($paypalVal != 'Disable') { ?>                            <div class="panel panel-default">                                <div class="panel-heading">                                    <h4 class="panel-title">                                        <a data-toggle="collapse" data-parent="#accordion" href="#collapse3">																														<?php if ($this->lang->line('Paypal') != '') {                                                $paypal= stripslashes($this->lang->line('Paypal'));                                            } else $paypal= "Paypal"; ?>										                                            <h5><?php echo $paypal; ?></h5></a>                                    </h4>                                </div>                                <div id="collapse3" class="panel-collapse collapse">                                    <div class="panel-body">                                        <img src="<?php echo base_url(); ?>images/paypal.png" width="70">                                        <br><br>                                        <button onclick="paypal_form();"                                                class="submitBtn"><?php if ($this->lang->line('Book it using Paypal') != '') {                                                echo stripslashes($this->lang->line('Book it using Paypal'));                                            } else echo "Book it using Paypal"; ?></button>                                    </div>                                </div>                            </div>                            <?php } ?>                                                  </div>												                        <p class="bottomTxt"><?php if ($this->lang->line('Bysubmittinga') != '') {                                                echo stripslashes($this->lang->line('Bysubmittinga'));                                            } else echo "By submitting a booking request, you accept the Renters"; ?>                            <a target="_blank" class="terms_link"                               href="<?php echo base_url(); ?>pages/terms-of-service"><?php if ($this->lang->line('terms of service') != '') {                                    echo stripslashes($this->lang->line('terms of service'));                                } else echo "terms of service"; ?></a></p>                    </div>                </div>            </div>        </div>    </section>    <script>        function stripePayment() {            var $form = $('#credit_card_forms_stripe');            $('#StripePaymentErrors').hide();            $('#loadingContainer').show();            $('#StripePaymentButton').prop('disabled', true);            Stripe.createToken($form, stripeResponseHandler);            return false;        }        var stripeResponseHandler = function (status, response) {            $('#loadingContainer').hide();            var $form = $('#credit_card_forms_stripe');            if (response.error) {                $('#StripePaymentErrors').text(response.error.message);                $('#StripePaymentErrors').fadeIn();                $('#StripePaymentButton').prop('disabled', false);            } else {                $('#StripePaymentErrors').hide();                var token = response.id;                $form.append($('<input type="hidden" name="stripeToken" />').val(token));                $form.get(0).submit();            }        };        function paypal_form() {            var product = <?php echo $this->uri->segment(5);?>;            var amount = $('#hosting_price').val();            var productAmount = $('#productPrice').val();            var commission = $('#commission').val();            var commission_type = $('#commission_type').val();            var hostingPrice = $('#hosting_priceAdminCur').val();            window.location = BaseURL + "site/product/HostPayment/" + product + "/" + amount + "/" + productAmount + "/" + commission + "/" + commission_type + "/" + hostingPrice;        }    </script><?php$this->load->view('site/includes/footer');?>