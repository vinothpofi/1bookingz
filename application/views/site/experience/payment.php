<?php$this->load->view('site/includes/header');$currency_result = $this->session->userdata('currency_result');$product = $ProductDetail->row();$hostCurrency = $product->currency;$commission = $hosting_payment_details->row()->commission_percentage;$promotion_type = $hosting_payment_details->row()->promotion_type;//echo 'Comision and promotion_type'.$hostCurrency .'|'.$this->session->userdata('currency_type');//print_r($currency_result);if ($promotion_type == 'percentage') {    $hosting_price = ($product->price / 100) * $commission;    if ($hostCurrency != "USD") {		$hosting_price = currency_conversion($hostCurrency, $this->session->userdata('currency_type'), $hosting_price);        /*if ($currency_result->$hostCurrency) {            $hosting_price = $hosting_price / $currency_result->$hostCurrency;        } else {            $hosting_price = currency_conversion($hostCurrency, $this->session->userdata('currency_type'), $hosting_price);        }*/    }} else {    $hosting_price = $commission;}define("StripeDetails", $this->config->item('payment_1'));$StripeValDet = unserialize(StripeDetails);$StripeVal = $StripeValDet['status'];define("paypal", $this->config->item('payment_0'));$paypal = unserialize(paypal);$paypalVal = $paypal['status'];$StripeValDet1 = unserialize($StripeValDet['settings']);?>    <script type="text/javascript" src="https://js.stripe.com/v2/"></script>    <script type="text/javascript">        Stripe.setPublishableKey('<?php echo $StripeValDet1['publishable_key']; ?>');    </script>    <section>        <div class="container">            <div class="row">                <div class="col-md-5 swapRight">                    <div class="paymentRight">                        <div class="tableRow head">                            <div class="left">                                <h5><?php echo ucfirst($product->experience_title); ?>                                    <small><?php                                        //echo ' - ';                                       // echo $currencySymbol;                                        if ($hostCurrency != $this->session->userdata('currency_type')) {                                            // if ($currency_result->$hostCurrency) {                                            //     echo $currency_result->$hostCurrency;                                            //     $global_price = $product->price / $currency_result->$hostCurrency;                                            //} else {                                                $global_price = currency_conversion($hostCurrency, $this->session->userdata('currency_type'), $product->price);                                            //}                                        } else {                                            $global_price = currency_conversion($hostCurrency, $this->session->userdata('currency_type'), $product->price);                                        }                                       // echo number_format($global_price, 2) . ' ' . $this->session->userdata('currency_type');                                        ?></small>                                </h5>                                <div class="sub"><?php $address = explode(',', $productAddress->row()->address);                                    $i = 1;                                    foreach ($address as $addr) {                                        echo $addr;                                        echo ($i == count($address)) ? '.' : ',';                                        echo '<br>';                                        $i++;                                    } ?></div>                            </div>                            <div class="right" style="width:35%">                                <?php                                $img_src = 'dummyProductImage.jpg';                                if ($productImage->row()->product_image != "" && file_exists('./images/experience/' . $productImage->row()->product_image)) {                                    $img_src = $productImage->row()->product_image;                                }                                echo img(base_url() . 'images/experience/' . $img_src, '', array("class" => "propImg","style"=>"width: 100%;padding: 3px;"));								 echo $currencySymbol.' '.number_format($global_price, 2) . ' ' . $this->session->userdata('currency_type');                                ?>                            </div>                        </div>                        <div class="divider"></div>                        <div class="tableRow">                            <div class="left">                                <p> <?php                                    if ($this->lang->line('This payment transacts in') != '') {                                        echo stripslashes($this->lang->line('This payment transacts in'));                                    } else echo "This payment transacts in ";                                     echo ' '.$currencySymbol;                                        /*if ($hostCurrency != $this->session->userdata('currency_type')) {                                                                                        // if ($currency_result->$hostCurrency) {                                            //     echo $currency_result->$hostCurrency;                                            //     $global_price = $product->price / $currency_result->$hostCurrency;                                            //} else {                                                $global_price = currency_conversion($hostCurrency, $this->session->userdata('currency_type'), $hosting_price);                                            //}                                        } else {                                                                                        $global_price = currency_conversion($hostCurrency, $this->session->userdata('currency_type'), $hosting_price);                                        }*/										if($this->session->userdata('currency_type')!="USD"){											$global_price = currency_conversion('USD', $this->session->userdata('currency_type'), $hosting_price);										}else{											 $global_price= $hosting_price;										}	                                        echo number_format($global_price, 2) . ' ' . $this->session->userdata('currency_type');                                                                           ?></p>                            </div>                            <div class="right">                                <h5></h5>                            </div>                        </div>                    </div>                </div>                <div class="col-md-7">                    <div class="paymentOption">                        <div class="panel-group" id="accordion">                            <?php                              if ($StripeVal != 'Disable' || $paypalVal != 'Disable') {                              if ($StripeVal != 'Disable') { ?>                            <div class="panel panel-default">                                <div class="panel-heading">                                    <h4 class="panel-title">                                        <a data-toggle="collapse" data-parent="#accordion" href="#collapse2">																														                                            <h5><?php                                    if ($this->lang->line('Stripe') != '') {                                        echo stripslashes($this->lang->line('Stripe'));                                    } else echo "Stripe";                                    ?></h5></a>                                    </h4>                                </div>                                <div id="collapse2" class="panel-collapse collapse in">                                    <div class="panel-body">                                        <div class="icons">                                            <img src="<?php echo base_url(); ?>images/visa.png">                                            <img src="<?php echo base_url(); ?>images/masterCard.png">                                            <img src="<?php echo base_url(); ?>images/americanExpress.png">                                            <img src="<?php echo base_url(); ?>images/discover.png">                                        </div>										<p class="text-center text-danger" id="cc_error_msg"></p>                                        <?php                                        echo form_open('site/experience/GuidePaymentCredit', array('id' => 'credit_card_forms_stripe'));                                        echo form_input(array('type' => 'hidden', 'name' => 'stripe_mode', 'id' => 'stripe_mode', 'value' => $StripeValDet1['mode']));                                        echo form_input(array('type' => 'hidden', 'name' => 'stripe_key', 'id' => 'stripe_key', 'value' => $StripeValDet1['secret_key']));                                        echo form_input(array('type' => 'hidden', 'name' => 'stripe_publish_key', 'id' => 'stripe_publish_key', 'value' => $StripeValDet1['publishable_key']));                                        echo form_input(array('type' => 'hidden', 'name' => 'payment_method', 'id' => 'payment_method', 'value' => 'CreditCard'));                                        echo form_input(array('type' => 'hidden', 'name' => 'commission', 'id' => 'commission', 'value' => $commission));                                        echo form_input(array('type' => 'hidden', 'name' => 'commission_type', 'id' => 'commission_type', 'value' => $promotion_type));                                        echo form_input(array('type' => 'hidden', 'name' => 'hosting_price', 'id' => 'hosting_price', 'value' => $hosting_price));                                        echo form_input(array('type' => 'hidden', 'name' => 'amount', 'id' => 'totprice', 'value' => $hosting_price));                                        echo form_input(array('type' => 'hidden', 'name' => 'booking_rental_id', 'id' => 'booking_rental_id', 'value' => $product->experience_id));                                        echo form_input(array('type' => 'hidden', 'name' => 'creditvalue', 'id' => 'creditvalue', 'value' => 'stripe'));                                        echo form_input(array('type' => 'hidden', 'name' => 'total_price', 'id' => 'total_price', 'value' => $hosting_price));                                        ?>                                        <p class="text-center text-success" id="loadingContainer"                                           style="display: none;"><i                                                    class="fa fa-spinner fa-spin fa-1x fa-fw"></i> <?php if ($this->lang->line('Please wait your transaction on process') != '') {                                                echo stripslashes($this->lang->line('Please wait your transaction on process'));                                            } else echo "Please wait your transaction on process"; ?></p>                                        <p class="text-center text-danger" id="StripePaymentErrors"                                           style="display: none;"></p>                                        <label><?php if ($this->lang->line('Card Type') != '') {                                                echo stripslashes($this->lang->line('Card Type'));                                            } else echo "Card Type"; ?></label>                                        <?php                                        if ($this->lang->line('Visa') != '') {                                            $visaLabel = stripslashes($this->lang->line('Visa'));                                        } else $visaLabel = 'Visa';                                        if ($this->lang->line('American Express') != '') {                                            $AmexLabel = stripslashes($this->lang->line('American Express'));                                        } else $AmexLabel = 'American Express';                                        if ($this->lang->line('MasterCard') != '') {                                            $MasterCardLabel = stripslashes($this->lang->line('MasterCard'));                                        } else $MasterCardLabel = 'MasterCard';                                        if ($this->lang->line('Discover') != '') {                                            $DiscoverLabel = stripslashes($this->lang->line('Discover'));                                        } else $DiscoverLabel = 'Discover';                                        $CardOptions = array('Visa' => $visaLabel, 'Amex' => $AmexLabel, 'MasterCard' => $MasterCardLabel, 'Discover' => $DiscoverLabel);                                        echo form_dropdown('cardType', $CardOptions, '', array('id' => 'cardType'));                                        ?>                                        <label><?php if ($this->lang->line('Credit Card Number') != '') {                                                echo stripslashes($this->lang->line('Credit Card Number'));                                            } else echo "Credit Card Number"; ?></label>																																	<?php if ($this->lang->line('enter_credit_card_num') != '') {                                                $enter_num= stripslashes($this->lang->line('enter_credit_card_num'));                                            } else $enter_num= "Enter Credit Card Number"; ?>											                                        <?php                                        echo form_input('cardNumber', '', array('placeholder' => $enter_num, 'autocomplete' => 'off', 'id' => 'cardNumber', 'maxlength' => '16', 'data-stripe' => 'number'));                                        ?>                                        <div class="row">                                            <div class="col-sm-6">                                                <div class="row">                                                    <label class="col-sm-12"><?php if ($this->lang->line('Expiration Date') != '') {                                                            echo stripslashes($this->lang->line('Expiration Date'));                                                        } else echo "Expiration Date"; ?></label>                                                    <div class="col-sm-5">                                                        <?php                                                        $expriedMonth = array();                                                        for ($i = 1; $i <= 12; $i++) {                                                            $expriedMonth[$i] = $i;                                                        }                                                        echo form_dropdown('CCExpMonth', $expriedMonth, date('m'), array('id' => 'CCExpMonth', 'data-stripe' => 'exp-month'));                                                        ?>                                                    </div>                                                    <div class="col-sm-7">                                                        <?php                                                        $expriedYear = array();                                                        for ($i = date('Y'); $i < (date('Y') + 30); $i++) {                                                            $expriedYear[$i] = $i;                                                        }                                                        echo form_dropdown('CCExpYear', $expriedYear, date('m'), array('id' => 'CCExpYear', 'data-stripe' => 'exp-year'));                                                        ?>                                                    </div>                                                </div>                                            </div>                                            <div class="col-sm-6">                                                <label><?php if ($this->lang->line('Security Code') != '') {                                                        echo stripslashes($this->lang->line('Security Code'));                                                    } else echo "Security Code"; ?>                                                </label>																																																<?php if ($this->lang->line('enter_security_code') != '') {                                                        $enter_sec= stripslashes($this->lang->line('enter_security_code'));                                                    } else $enter_sec= "Enter Security Code"; ?>												                                                <?php                                                echo form_password('creditCardIdentifier', '', array('placeholder' => $enter_sec, 'autocomplete' => 'off', 'id' => 'creditCardIdentifier', 'data-stripe' => 'cvc'));                                                ?>                                            </div>                                        </div>                                        <button class="submitBtn" onclick="return stripePayment();"                                                id="StripePaymentButton"><?php if ($this->lang->line('Book it using Credit Card') != '') {                                                echo stripslashes($this->lang->line('Book it using Credit Card'));                                            } else echo "Book it using Credit Card"; ?></button>                                        <?php echo form_close(); ?>                                    </div>                                </div>                            </div>                        <?php }                          if ($paypalVal != 'Disable') {                         ?>                            <div class="panel panel-default">                                <div class="panel-heading">                                    <h4 class="panel-title">                                        <a data-toggle="collapse" data-parent="#accordion" href="#collapse3">                                            <h5><?php                                    if ($this->lang->line('Paypal') != '') {                                        echo stripslashes($this->lang->line('Paypal'));                                    } else echo "Paypal";                                    ?></h5></a>																						                                    </h4>                                </div>                                <div id="collapse3" class="panel-collapse collapse">                                    <div class="panel-body">                                        <img src="<?php echo base_url(); ?>images/paypal.png" width="70">                                        <br><br>                                        <button onclick="paypal_form();"                                                class="submitBtn"><?php if ($this->lang->line('Book it using Paypal') != '') {                                                echo stripslashes($this->lang->line('Book it using Paypal'));                                            } else echo "Book it using Paypal"; ?></button>                                    </div>                                </div>                            </div>                        <?php } } else { ?>                                <p class="text-center text-danger">No Payment Method is Available</p>                                <?php                            }                            ?>                        </div>						                        <p class="bottomTxt"><?php if ($this->lang->line('by_submitting_accept') != '') {                                    echo stripslashes($this->lang->line('by_submitting_accept'));                                } else echo "By submitting a booking request, you accept the Renters"; ?>                            <a target="_blank" class="terms_link"                               href="<?php echo base_url(); ?>pages/terms-of-service"><?php if ($this->lang->line('terms of service') != '') {                                    echo stripslashes($this->lang->line('terms of service'));                                } else echo "terms of service"; ?></a></p>                    </div>                </div>            </div>        </div>    </section>    <script>        function stripePayment() {			var card_no = $("#cardNumber").val();			var security_code = $("#creditCardIdentifier").val();			if (card_no == "") {				$("#cc_error_msg").html("Please provide credit card Number");				return false;			}			else if (isNaN(card_no)) {				$("#cc_error_msg").html("Please provide valid credit card Number");				return false;			}			else {				$("#cc_error_msg").html("");			}			if (security_code == "") {				$("#cc_error_msg").html("Please provide security code");				return false;			}			else if (isNaN(security_code)) {				$("#cc_error_msg").html("Please provide valid security code");				return false;			}			else {				$("#cc_error_msg").html("");			}            var $form = $('#credit_card_forms_stripe');            $('#StripePaymentErrors').hide();            $('#loadingContainer').show();            $('#StripePaymentButton').prop('disabled', true);            Stripe.createToken($form, stripeResponseHandler);            return false;        }        var stripeResponseHandler = function (status, response) {            $('#loadingContainer').hide();            var $form = $('#credit_card_forms_stripe');            if (response.error) {                $('#StripePaymentErrors').text(response.error.message);                $('#StripePaymentErrors').fadeIn();                $('#StripePaymentButton').prop('disabled', false);            } else {                $('#StripePaymentErrors').hide();                var token = response.id;                $form.append($('<input type="hidden" name="stripeToken" />').val(token));                $form.get(0).submit();            }        };        function paypal_form() {            var product = "<?php echo $this->uri->segment(5);?>";            var amount = $('#totprice').val();            window.location = BaseURL + "site/experience/GuidePayment/" + product + "/" + amount;        }    </script><?php$this->load->view('site/includes/footer');?>